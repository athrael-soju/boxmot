# ─────────────────────────────────────────
# 1. Build system
# ─────────────────────────────────────────
[build-system]
requires    = ["pdm-backend"]
build-backend = "pdm.backend"

# ─────────────────────────────────────────
# 2. Core project metadata (PEP 621)
# ─────────────────────────────────────────
[project]
name             = "boxmot"
version          = "12.0.8"
description      = "BoxMOT: pluggable SOTA tracking modules for segmentation, object detection and pose estimation models"
readme           = "README.md"
license          = { text = "AGPL-3.0" }
authors          = [{ name = "Mikel Broström" }]
requires-python  = ">=3.9,<=3.12"
keywords         = [
  "tracking",
  "tracking-by-detection",
  "machine-learning",
  "deep-learning",
  "vision",
  "ML",
  "DL",
  "AI",
  "YOLO",
]
classifiers      = [
  "Development Status :: 4 - Beta",
  "Intended Audience :: Developers",
  "Intended Audience :: Education",
  "Intended Audience :: Science/Research",
  "License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.9",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Topic :: Software Development",
  "Topic :: Scientific/Engineering",
  "Topic :: Scientific/Engineering :: Artificial Intelligence",
  "Topic :: Scientific/Engineering :: Image Recognition",
  "Topic :: Scientific/Engineering :: Image Processing",
]

# ─────────────────────────────────────────
# 3. Core dependencies
# ─────────────────────────────────────────
dependencies = [
  "setuptools>=78.0.0",
  "filterpy>=1.4.5,<2.0.0",
  "gdown>=5.1.0,<6.0.0",
  "lapx>=0.5.5,<1.0.0",
  "loguru>=0.7.2,<1.0.0",
  "numpy==1.26.4",
  "pyyaml>=6.0.1,<7.0.0",
  "regex>=2024.0.0,<2025.0.0",
  "yacs>=0.1.8,<1.0.0",
  "scikit-learn>=1.3.0,<2.0.0",
  "pandas>=2.0.0,<3.0.0",
  "opencv-python>=4.7.0,<5.0.0",
  "ftfy>=6.1.3,<7.0.0",
  "gitpython>=3.1.42,<4.0.0",
  "torch>=2.2.1,<3.0.0; sys_platform == \"darwin\" or sys_platform == \"linux\" or sys_platform == \"win32\"",
  "torchvision>=0.17.1,<1.0.0; sys_platform == \"darwin\" or sys_platform == \"linux\" or sys_platform == \"win32\"",
]


# ─────────────────────────────────────────
# 4. Optional / grouped dependencies
# ─────────────────────────────────────────
[project.optional-dependencies]
dev               = [
  "pytest>=8.0.2,<9.0.0",
  "isort>=5.13.2,<6.0.0",
  "pytest-cov>=6.0.0,<7.0.0",
  "ipykernel>=6.29.5,<7.0.0",
]
yolo               = [
  "ultralytics @ git+https://github.com/mikel-brostrom/ultralytics.git",
  "rfdetr",
  #"yolox==0.3.0"
]
evolve             = [
  "ray[tune]>=2.35.0,<3.0.0",
  "plotly>=5.19.0,<6.0.0",
  "joblib>=1.3.2,<2.0.0",
]
"onnx-exporter"    = [
  "onnx>=1.16.1",
  "onnxruntime>=1.16.1,<2.0.0",
  "onnx-simplifier>=0.4.1",
]
"openvino-exporter" = [
  "openvino-dev>=2023.3",
]
"tflite-exporter"  = [
  "onnx2tf>=1.18.0",
  "onnx>=1.16.1",
  "tensorflow==2.17.0",
  "tf_keras",
  "sng4onnx>=1.0.1",
  "onnx_graphsurgeon>=0.3.26",
  "onnxslim>=0.1.31",
  "onnxruntime",
  "flatbuffers>=23.5.26",
  "onnxsim>=0.4.33",
  "psutil==5.9.5",
  "ml_dtypes==0.3.2",
  "ai_edge_litert>=1.2.0",
]
yolox-build-deps = [
  "setuptools>=78.0.0",
]

# ─────────────────────────────────────────
# 5. Custom PyPI indexes (uv)
# ─────────────────────────────────────────
[tool.uv]
no-build-isolation-package = ["yolox"]

[[tool.uv.index]]
name        = "testpypi"
url         = "https://test.pypi.org/simple/"
publish-url = "https://test.pypi.org/legacy/"
explicit    = true

[[tool.uv.dependency-metadata]]
name = "yolox"
version = "0.3.0"
requires-dist = ["onnx>=1.17.0", "onnxsim<1.0.0,>=0.4.36"]

# ─────────────────────────────────────────
# 6. Linting configuration
# ─────────────────────────────────────────
[tool.flake8]
max-line-length = 120
format          = "pylint"
doctests        = true
verbose         = 2
select          = ["E", "W", "F"]
ignore          = ["E731", "F405", "E402", "W504", "W605", "E741"]
exclude         = [".tox", "*.egg", "build", "temp"]
